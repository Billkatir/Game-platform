<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Available Games</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 600px;
        margin: 2em auto;
        padding: 2em;
      }
      h2 {
        text-align: center;
      }
      ul {
        list-style: none;
        padding: 0;
      }
      li {
        margin: 1em 0;
        padding: 1em;
        border: 1px solid #ccc;
        border-radius: 6px;
        cursor: pointer;
      }
      li:hover {
        background-color: #f0f0f0;
      }
    </style>
  </head>
  <body>
    <h2>Available Games</h2>
    <ul id="games-list"></ul>

    <script>
      const token = localStorage.getItem("token");

      if (!token) {
        window.location.href = "index.html"; // Redirect if not logged in
      }

      fetch("http://127.0.0.1:8000/games", {
        headers: {
          Authorization: `Bearer ${token}`,
        },
      })
        .then((res) => {
          if (!res.ok) throw new Error("Failed to fetch games");
          return res.json();
        })
        .then((games) => {
          const list = document.getElementById("games-list");
          games.forEach((game) => {
            const li = document.createElement("li");
            li.textContent = `${game.name} (${game.endpoint})`;
            li.onclick = () => {
              if (game.name.toLowerCase().replace(/\s+/g, "") === "tictactoe") {
                window.location.href = "tictactoe.html";
              } else {
                alert("No page implemented for " + game.name);
              }
            };
            list.appendChild(li);
          });
        })
        .catch((err) => {
          console.error("Failed to fetch games", err);
          alert("Failed to load games. Please log in again.");
          localStorage.removeItem("token"); // Clear token on error
          window.location.href = "index.html";
        });
    </script>
  </body>
</html>
